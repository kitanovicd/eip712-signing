<html>
<head>
<title>EIP-712 Signing</title>
<style>
body { text-align: center; padding: 20px; }
button { padding: 10px 20px; margin: 5px; }
#signatureContainer { margin-top: 20px; word-wrap: break-word; max-width: 600px; }
</style>
</head>
<body>
<button id="connectButton">Connect Wallet</button>
<button id="signButton" disabled>Sign Safe Transaction</button>
<div id="signatureContainer"></div>
<script>
const typedData = {
  types: {
    EIP712Domain: [{ name: "chainId", type: "uint256" }, { name: "verifyingContract", type: "address" }],
    SafeTx: [{ name: "to", type: "address" }, { name: "value", type: "uint256" }, { name: "data", type: "bytes" }, { name: "operation", type: "uint8" }, { name: "safeTxGas", type: "uint256" }, { name: "baseGas", type: "uint256" }, { name: "gasPrice", type: "uint256" }, { name: "gasToken", type: "address" }, { name: "refundReceiver", type: "address" }, { name: "nonce", type: "uint256" }]
  },
  domain: { chainId: 964, verifyingContract: "0x2Cf793156eeeBeBf150eb3e2505304E6bA087147" },
  primaryType: "SafeTx",
  message: { to: "0x9bB4FC27453e04318bf968f2E994B47eDa8F724D", value: "0", data: "0xa08d56540000000000000000000000008f9864c1f79ebc8aec0949671ac0463bf40e593300000000000000000000000000000000000000000000000000005af3107a400000000000000000000000000000000000000000000000000000005af3107a4000", operation: 0, safeTxGas: 0, baseGas: 0, gasPrice: 0, gasToken: "0x0000000000000000000000000000000000000000", refundReceiver: "0x0000000000000000000000000000000000000000", nonce: 0 }
};

const connectButton = document.getElementById("connectButton");
const signButton = document.getElementById("signButton");
const signatureContainer = document.getElementById("signatureContainer");
let account;

connectButton.onclick = async () => {
  if (!window.ethereum) {
    signatureContainer.innerText = "Install MetaMask!";
    return;
  }
  try {
    const accounts = await window.ethereum.request({ method: "eth_requestAccounts" });
    account = accounts[0];
    const chainId = await window.ethereum.request({ method: "eth_chainId" });
    if (parseInt(chainId, 16) !== 964) {
      signatureContainer.innerText = "Switch to Chain ID 964!";
      return;
    }
    connectButton.innerText = `Connected: ${account.slice(0, 6)}...${account.slice(-4)}`;
    connectButton.disabled = true;
    signButton.disabled = false;
    signatureContainer.innerText = "Connected. Click 'Sign Safe Transaction'.";
  } catch (error) {
    signatureContainer.innerText = "Error: " + error.message;
  }
};

signButton.onclick = async () => {
  if (!account) {
    signatureContainer.innerText = "Connect wallet first!";
    return;
  }
  try {
    const signature = await window.ethereum.request({
      method: "eth_signTypedData_v4",
      params: [account, JSON.stringify(typedData)]
    });
    signatureContainer.innerText = "Signature: " + signature;
  } catch (error) {
    signatureContainer.innerText = "Error: " + error.message;
  }
};
</script>
</body>
</html>
